---
title: "Untitled"
author: "Benny"
date: "11/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(childesr)
library(text2vec)

project_root <- here::here()


```


```{r}
d_utterances <- 
  get_utterances(collection = "Eng-NA")

```

```{r}
d_utterances_arranged <- 
  d_utterances %>% 
  arrange(transcript_id, utterance_order) %>% 
  filter(speaker_role %in% c(
    "Mother",
    "Grandmother",
    "Father",
    "Adult"
  ))

groups <- 
  d_utterances_arranged %>% 
  group_by(transcript_id) %>%
  group_split

collapse_words <- function(transcript) {
  return(transcript %>% pull(stem) %>% paste(collapse = " "))
} 



#make a list of all of the transcripts
transcript_list <- 
  groups %>% 
  map(collapse_words)

write_file(
  transcript_list %>% paste(collapse = "\n\n"), 
  file = fs::path(project_root, "all_transcripts.txt")
)




```


```{r}

txt <- read_lines(fs::path(project_root, "all_transcripts.txt"))

it <- itoken(txt, progressbar = FALSE)

vocab <- 
  text2vec::create_vocabulary(it) %>% 
  prune_vocabulary(term_count_min = 5)

vectorizer <- vocab_vectorizer(vocab)

childes_tcm <- create_tcm(it, vectorizer, skip_grams_window = 10)

glove <- GlobalVectors$new(rank = 50, x_max = 10)

word_vectors <- glove$fit_transform(childes_tcm, n_iter = 20)

word_vectors_context <- glove$components

full_vectors <- word_vectors + t(word_vectors_context)



```

